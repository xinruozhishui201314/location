# 融合定位系统配置文件

fused_localization:
  ros__parameters:
    # 输出频率 (Hz)
    output_frequency: 100.0
    
    # 先验地图路径
    prior_map_path: "/path/to/prior_map.pcd"
    
    # 初始化选项
    init_with_map: true      # 使用先验地图初始化
    init_with_qr: true       # 使用二维码初始化
    init_with_gps: true      # 使用GPS/RTK初始化
    init_timeout: 10.0       # 初始化超时时间（秒）
    
    # GPS参数
    gps_cov_threshold: 2.0   # GPS协方差阈值
    
    # 关键帧参数
    max_keyframe_num: 100
    keyframe_distance_threshold: 1.0    # 米
    keyframe_angle_threshold: 0.2       # 弧度
    voxel_leaf_size: 0.2                # 体素滤波尺寸（米）
    
    # 动态去除与鲁棒配准
    dynamic_remove_enable: true
    sor_mean_k: 20
    sor_std_mul: 1.0
    icp_max_corr_dist: 1.0
    icp_max_iterations: 50
    icp_fitness_threshold: 0.5
    ndt_resolution: 1.0
    ndt_fitness_threshold: 1.0
    gicp_fitness_threshold: 0.5
    relocalization_fitness_threshold: 2.0
    relocalization_min_inlier_ratio: 0.2
    relocalization_timeout: 2.0        # 秒
    init_max_trials: 3
    scan_context_enable: false         # 启用 Scan Context/ISC 全局检索
    scan_context_topk: 5               # 取前 K 个候选
    teaser_enable: false               # 启用 TEASER++ 超鲁棒初值
    teaser_max_corr_dist: 2.0          # TEASER++ 最大对应距离（米）
    teaser_noise_bound: 0.05           # TEASER++ 噪声界（米）
    image_enable: true                 # 启用图像辅助（姿态融合）
    image_weight: 0.3                  # 图像姿态权重 [0,1]
    image_fx: 500.0
    image_fy: 500.0
    image_cx: 320.0
    image_cy: 240.0
    image_min_matches: 50              # 最小有效匹配点数
    
    # 点云处理
    voxel_leaf_size: 0.2    # 体素滤波尺寸（米）
    
    # 传感器话题
    lidar_topic: "lidar/points"
    imu_topic: "imu/data"
    image_topic: "camera/image"
    gps_topic: "gps/fix"
    rtk_topic: "rtk/odometry"
    
    # 坐标系
    map_frame: "map"
    base_frame: "base_link"
    lidar_frame: "laser_link"
    camera_frame: "camera_link"
    
    # 外参（相机到LiDAR）
    camera_to_lidar:
      translation: [0.0, 0.0, 0.0]
      rotation: [0.0, 0.0, 0.0, 1.0]  # x, y, z, w
    
    # 二维码数据库
    qr_code_database_path: "/path/to/qr_codes.yaml"

